var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},ButtonUI=function(t){function e(){var e=t.call(this)||this;return e._label="按钮",e.create(),e}return __extends(e,t),Object.defineProperty(e.prototype,"label",{set:function(t){this._label=t,this._labelTxt.text=t},enumerable:!0,configurable:!0}),e.prototype.create=function(){this.graphics.lineStyle(1,16776960),this.graphics.beginFill(255),this.graphics.drawRoundRect(0,0,100,50,10),this.graphics.endFill(),this._labelTxt=new egret.TextField,this._labelTxt.textColor=16776960,this._labelTxt.textAlign=egret.HorizontalAlign.CENTER,this._labelTxt.verticalAlign=egret.VerticalAlign.MIDDLE,this._labelTxt.text=this.label,this._labelTxt.width=100,this._labelTxt.height=50,this.addChild(this._labelTxt)},e}(egret.Sprite);__reflect(ButtonUI.prototype,"ButtonUI");var Card=function(t){function e(e,i){var s=t.call(this)||this;return s._isface=!1,s._speed=.1,s.width=150,s.height=200,s.anchorOffsetX=s.width/2,s._faceID=e,s._backID=i,s.drawMask(),s.draw(),s}return __extends(e,t),Object.defineProperty(e.prototype,"faceID",{get:function(){return this._faceID},enumerable:!0,configurable:!0}),e.prototype.init=function(){this._isface=!0,this.reverse()},e.prototype.draw=function(){this.graphics.clear(),this.graphics.beginFill(16777215),this.graphics.drawRoundRect(0,0,this.width,this.height,30),this.graphics.endFill();var t=RES.getRes(this._faceID);this._faceImg=new egret.Bitmap(t),this._faceImg.width=this.width,this._faceImg.height=this.height,this._faceImg.mask=this._mask;var e=RES.getRes(this._backID);this._backImg=new egret.Bitmap(e),this._backImg.mask=this._mask,this.addChild(this._backImg)},e.prototype.drawMask=function(){this._mask=new egret.Shape,this._mask.graphics.clear(),this._mask.graphics.beginFill(16777215),this._mask.graphics.drawRoundRect(0,0,this.width,this.height,30),this._mask.graphics.endFill(),this.addChild(this._mask)},e.prototype.reverse=function(){this._isface=!this._isface,egret.startTick(this.enterFrameHandler,this)},e.prototype.enterFrameHandler=function(){return this.scaleX-=this._speed,Math.abs(this.scaleX)<.1&&(this._isface?(-1!=this.getChildIndex(this._backImg)&&this.removeChild(this._backImg),this.addChild(this._faceImg)):(-1!=this.getChildIndex(this._faceImg)&&this.removeChild(this._faceImg),this.addChild(this._backImg)),this._speed=-.1),1==this.scaleX&&(egret.stopTick(this.enterFrameHandler,this),this._speed=.1),!0},e}(egret.Sprite);__reflect(Card.prototype,"Card");var Main=function(t){function e(){var e=t.call(this)||this;return e.numCards=12,e.cards=[],e.firstCard=null,e.secondCard=null,e.once(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onGroupComplete,this),RES.loadConfig("resource/default.res.json","resource/"),RES.loadGroup("preload")},e.prototype.onGroupComplete=function(){this.addBackground(),this.createCard(),this.addCardToStage(),this.addScoreUI(),this.addReplyButton(),this.cards.forEach(this.addEvent,this)},e.prototype.addBackground=function(){var t=new egret.Bitmap(RES.getRes("faces.beijing"));t.width=this.stage.stageWidth,t.height=this.stage.stageHeight,this.addChild(t)},e.prototype.addScoreUI=function(){this.scoreUI=new ScoreUI,this.scoreUI.x=85,this.scoreUI.y=30,this.addChild(this.scoreUI)},e.prototype.addReplyButton=function(){var t=this,e=new ButtonUI;e.label="重玩",e.x=this.stage.stageWidth/2-50,e.y=this.stage.stageHeight-130,this.addChild(e),e.touchEnabled=!0,e.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){t.firstCard=null,t.secondCard=null,t.scoreUI.score=0,t.addCardToStage()},this)},e.prototype.createCard=function(){for(var t=0;t<this.numCards;t++){var e=Math.floor(t/2)+1,i="faces.f"+e,s="faces.cardbg",r=new Card(i,s);this.cards.push(r)}},e.prototype.addCardToStage=function(){this.shuffle(this.cards);for(var t=0;t<this.cards.length;t++){var e=t%3,i=Math.floor(t/3);this.cards[t].x=160+160*e,this.cards[t].y=100+210*i,this.cards[t].init(),this.addChild(this.cards[t])}},e.prototype.addEvent=function(t){var e=this;console.log(this),t.touchEnabled=!0,t.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(t){var i=t.currentTarget;if(!e.secondCard)if(e.firstCard)if(i==e.firstCard)i.reverse(),e.firstCard=null;else{e.secondCard=i,i.reverse();var s=e;setTimeout(function(){s.check()},1e3)}else e.firstCard=i,i.reverse()},this)},e.prototype.check=function(){var t=this.firstCard.faceID==this.secondCard.faceID;t?(this.removeChild(this.firstCard),this.removeChild(this.secondCard),this.scoreUI.score++):(this.firstCard.reverse(),this.secondCard.reverse()),this.firstCard=null,this.secondCard=null},e.prototype.shuffle=function(t){for(var e=t.length-1;e>0;e--){var i=Math.floor(Math.random()*e);if(i!=e){var s=t[e];t[e]=t[i],t[i]=s}}},e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var ScoreUI=function(t){function e(){var e=t.call(this)||this;return e._score=0,e.create(),e}return __extends(e,t),Object.defineProperty(e.prototype,"score",{get:function(){return this._score},set:function(t){this._score=t,this._inputTxt.text=String(this._score)},enumerable:!0,configurable:!0}),e.prototype.create=function(){var t=new egret.TextField;t.textColor=16776960,t.text="score:",t.width=100,t.height=30,this.addChild(t),this._inputTxt=new egret.TextField,this._inputTxt.textColor=16776960,this._inputTxt.x=110,this._inputTxt.text=String(this._score),this.addChild(this._inputTxt)},e}(egret.Sprite);__reflect(ScoreUI.prototype,"ScoreUI");