var __reflect=this&&this.__reflect||function(e,t,i){e.__class__=t,i?i.push(t):i=[t],e.__types__=e.__types__?i.concat(e.__types__):i},__extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s]);i.prototype=t.prototype,e.prototype=new i},__awaiter=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))(function(r,n){function a(e){try{c(s.next(e))}catch(t){n(t)}}function o(e){try{c(s["throw"](e))}catch(t){n(t)}}function c(e){e.done?r(e.value):new i(function(t){t(e.value)}).then(a,o)}c((s=s.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function i(e){return function(t){return s([e,t])}}function s(i){if(r)throw new TypeError("Generator is already executing.");for(;c;)try{if(r=1,n&&(a=n[2&i[0]?"return":i[0]?"throw":"next"])&&!(a=a.call(n,i[1])).done)return a;switch(n=0,a&&(i=[0,a.value]),i[0]){case 0:case 1:a=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,n=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(a=c.trys,!(a=a.length>0&&a[a.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){c.label=i[1];break}if(6===i[0]&&c.label<a[1]){c.label=a[1],a=i;break}if(a&&c.label<a[2]){c.label=a[2],c.ops.push(i);break}a[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(s){i=[6,s],n=0}finally{r=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var r,n,a,o,c={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o},LoadingUI=function(e){function t(){var t=e.call(this)||this;return t.createView(),t}return __extends(t,e),t.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},t.prototype.onProgress=function(e,t){this.textField.text="Loading..."+e+"/"+t},t}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var Main=function(e){function t(){var t=e.call(this)||this;return t.cards=[],t.cardsPos=[],t.cardsInitPos=[],t.isdeal=!1,t.dealTimes=0,t.selectedCards=[],t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t}return __extends(t,e),t.prototype.onAddToStage=function(e){egret.lifecycle.addLifecycleListener(function(e){e.onUpdate=function(){}}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()},this.runGame()["catch"](function(e){console.log(e)})},t.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(i){switch(i.label){case 0:return[4,this.loadResource()];case 1:return i.sent(),this.createGameScene(),[4,RES.getResAsync("description_json")];case 2:return e=i.sent(),[4,platform.login()];case 3:return i.sent(),[4,platform.getUserInfo()];case 4:return t=i.sent(),console.log(t),[2]}})})},t.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(i){switch(i.label){case 0:return i.trys.push([0,3,,4]),e=new LoadingUI,this.stage.addChild(e),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return i.sent(),[4,RES.loadGroup("preload",0,e)];case 2:return i.sent(),this.stage.removeChild(e),[3,4];case 3:return t=i.sent(),console.error(t),[3,4];case 4:return[2]}})})},t.prototype.createGameScene=function(){this.addGameBackground(),this.setCards(),this.setCardsPos(),this.setCardsInitPos();for(var e=0;15>e;e++){var t=this.cards[e];t.x=this.cardsInitPos[e].x,t.y=this.cardsInitPos[e].y,this.addChild(t)}this.addGameUI()},t.prototype.addGameUI=function(){var e=this.createBitmapByName("dealBtn");this.addChild(e),e.touchEnabled=!0,e.x=this.stage.stageWidth/2+130,e.y=this.stage.stageHeight-80,e.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.dealHandler,this);var t=this.createBitmapByName("acceptBtn");this.addChild(t),t.touchEnabled=!0,t.x=this.stage.stageWidth/2+230,t.y=this.stage.stageHeight-80,t.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.acceptHandler,this);var i=this.createBitmapByName("updateBtn");this.addChild(i),i.touchEnabled=!0,i.x=this.stage.stageWidth/2+330,i.y=this.stage.stageHeight-80,i.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.updateHandler,this),this.selectUI=new SelectListUI,this.addChild(this.selectUI),this.selectUI.addEventListener("select",this.selectedHandler,this),this.selectUI.x=394,this.selectUI.y=640,this.dealTimesInfo=new egret.TextField,this.dealTimesInfo.x=80,this.dealTimesInfo.y=360,this.dealTimesInfo.textColor=16776960,this.dealTimesInfo.size=30,this.dealTimesInfo.text="第"+this.dealTimes+"次发牌",this.addChild(this.dealTimesInfo),this.selectedText=new egret.TextField,this.selectedText.x=75,this.selectedText.y=610,this.selectedText.textColor=16776960,this.selectedText.size=30,this.selectedText.text="你选择的牌",this.addChild(this.selectedText),this.selectedText.visible=!1,this.tips=new egret.TextField,this.tips.x=50,this.tips.y=680,this.tips.textColor=16776960,this.tips.size=40,this.addChild(this.tips)},t.prototype.addGameBackground=function(){var e=new egret.Shape;e.graphics.beginFill(2640246),e.graphics.drawRect(0,0,this.stage.stageWidth,this.stage.stageHeight),this.addChild(e);var t=new egret.Shape;t.graphics.beginFill(16777215,.1),t.graphics.drawRect(0,0,200,310),this.addChild(t),t.x=50,t.y=40},t.prototype.updateHandler=function(){this.shuffer(this.cards);for(var e=0;15>e;e++)this.cards[e].x=this.cardsInitPos[e].x,this.cards[e].y=this.cardsInitPos[e].y,this.setChildIndex(this.cards[e],e+15);this.dealTimes=0,this.dealTimesInfo.text="第"+this.dealTimes+"次发牌",this.selectedText.visible=!1,this.isdeal=!1,this.selectUI.init()},t.prototype.dealHandler=function(e){this.isdeal||(this.dealTimes++,this.dealTimesInfo.text="第"+this.dealTimes+"次发牌",this.startDealCard(),this.selectUI.init(),this.isdeal=!0)},t.prototype.startDealCard=function(){for(var e=function(e){egret.setTimeout(function(){var t=this.cards[e],i=this.cardsPos[e];egret.Tween.get(t).to({x:i.x,y:i.y},100).call(function(){this.setChildIndex(t,15-e)},this)},t,1400-100*e)},t=this,i=0;i<this.cards.length;i++)e(i)},t.prototype.selectedHandler=function(){if(3==this.dealTimes){var e=void 0;switch(this.selectUI.selectId){case 0:return void this.showTips("提示：请选择你的牌所在的列！");case 1:e=[13,10,7,4,1,14,11,8,5,2,12,9,6,3,0];break;case 2:e=[14,11,8,5,2,13,10,7,4,1,12,9,6,3,0];break;case 3:e=[14,11,8,5,2,12,9,6,3,0,13,10,7,4,1]}for(var t=[],i=5;10>i;i++)t.push(this.cards[e[i]]);var s=t[2],r=new egret.Point(75,400);this.setChildIndex(s,100),egret.Tween.get(s).to({x:r.x,y:r.y,rotation:360},1e3).call(function(){this.selectedText.visible=!0},this)}},t.prototype.acceptHandler=function(e){if(!this.isdeal)return void this.showTips("请先发牌！");var t;switch(this.selectUI.selectId){case 0:return void this.showTips("提示：请选择你的牌所在的列！");case 1:t=[13,10,7,4,1,14,11,8,5,2,12,9,6,3,0];break;case 2:t=[14,11,8,5,2,13,10,7,4,1,12,9,6,3,0];break;case 3:t=[14,11,8,5,2,12,9,6,3,0,13,10,7,4,1]}for(var i=[],s=0;15>s;s++){var r=this.cards[t[s]];this.setChildIndex(r,s+5),i.push(r)}this.cards=i;for(var n=function(e){egret.setTimeout(function(){var t=this.cardsInitPos[e];this.setChildIndex(this.cards[e],e+15),egret.Tween.get(this.cards[e]).to({x:t.x,y:t.y},250)},a,300*Math.floor(e/5))},a=this,s=0;s<this.cards.length;s++)n(s);this.selectUI.init(),this.isdeal=!1,this.selectedText.visible=!1},t.prototype.setCardsPos=function(){for(var e=0;5>e;e++)for(var t=0;3>t;t++)this.cardsPos.push(new egret.Point(800-240*t,380-80*e))},t.prototype.setCardsInitPos=function(){for(var e=0;15>e;e++)this.cardsInitPos.push(new egret.Point(75,60+5*e))},t.prototype.setCards=function(){for(var e=[],t=["a","b","c","d"];this.cards.length<15;){var i=t[Math.floor(4*Math.random())],s=Math.ceil(13*Math.random()),r=i+s;if(-1==e.indexOf(r)){e.push(r);var n=this.createBitmapByName("cards#"+r);n.width=150,n.height=200,this.cards.push(n)}}},t.prototype.showTips=function(e){this.tips.text=e,egret.setTimeout(function(){this.tips.text=""},this,2e3)},t.prototype.createBitmapByName=function(e){var t=new egret.Bitmap,i=RES.getRes(e);return t.texture=i,t},t.prototype.shuffer=function(e){for(var t=0,i=e.length;i>t;t++){var s=Math.floor(Math.random()*i),r=e[t];e[t]=e[s],e[s]=r}},t}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var DebugPlatform=function(){function e(){}return e.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,{nickName:"username"}]})})},e.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},e}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var SelectedButton=function(e){function t(){var t=e.call(this)||this;return t._select=!1,t.createView(),t}return __extends(t,e),Object.defineProperty(t.prototype,"select",{get:function(){return this._select},set:function(e){e?(this._selectedImg.visible=!0,this._unselectedImg.visible=!1,this.drawSelectedBg(!0)):(this._selectedImg.visible=!1,this._unselectedImg.visible=!0,this.drawSelectedBg(!1))},enumerable:!0,configurable:!0}),t.prototype.createView=function(){this._selectedBg=new egret.Shape,this.drawSelectedBg(!1),this.addChild(this._selectedBg),this._unselectedImg=this.createBitmapByName("button#unselect"),this.addChild(this._unselectedImg),this._unselectedImg.width=30,this._unselectedImg.height=30,this._unselectedImg.x=-15,this._unselectedImg.y=-15,this._selectedImg=this.createBitmapByName("button#select"),this.addChild(this._selectedImg),this._selectedImg.width=30,this._selectedImg.height=30,this._selectedImg.x=-15,this._selectedImg.y=-15,this._selectedImg.visible=!1,this._unselectedImg.visible=!0},t.prototype.drawSelectedBg=function(e){this._selectedBg.graphics.clear(),e&&this._selectedBg.graphics.lineStyle(1,16776960),this._selectedBg.graphics.beginFill(16777215,.1),this._selectedBg.graphics.drawRoundRect(-100,-600,200,600,30,30),this._selectedBg.graphics.endFill()},t.prototype.createBitmapByName=function(e){var t=new egret.Bitmap,i=RES.getRes(e);return t.texture=i,t},t}(egret.Sprite);__reflect(SelectedButton.prototype,"SelectedButton");var SelectListUI=function(e){function t(){var t=e.call(this)||this;return t._selectId=0,t._selectBtnList=[],t.createView(),t}return __extends(t,e),Object.defineProperty(t.prototype,"selectId",{get:function(){return this._selectId},enumerable:!0,configurable:!0}),t.prototype.init=function(){for(var e=0;3>e;e++)this._selectBtnList[e].select=!1;this._selectId=0},t.prototype.createView=function(){for(var e=0;3>e;e++){var t=new SelectedButton;this.addChild(t),t.x=240*e,t.touchEnabled=!0,this._selectBtnList.push(t),t.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.clickHandler,this)}},t.prototype.clickHandler=function(e){var t=e.currentTarget;this._selectId=this._selectBtnList.indexOf(t)+1,t.select=!0;for(var i=0;3>i;i++)i!=this._selectId-1&&(this._selectBtnList[i].select=!1);this.dispatchEvent(new egret.Event("select"))},t}(egret.Sprite);__reflect(SelectListUI.prototype,"SelectListUI");