var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);i.prototype=e.prototype,t.prototype=new i},__awaiter=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))(function(r,n){function o(t){try{c(s.next(t))}catch(e){n(e)}}function a(t){try{c(s["throw"](t))}catch(e){n(e)}}function c(t){t.done?r(t.value):new i(function(e){e(t.value)}).then(o,a)}c((s=s.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function i(t){return function(e){return s([t,e])}}function s(i){if(r)throw new TypeError("Generator is already executing.");for(;c;)try{if(r=1,n&&(o=n[2&i[0]?"return":i[0]?"throw":"next"])&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[0,o.value]),i[0]){case 0:case 1:o=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,n=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(o=c.trys,!(o=o.length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){c.label=i[1];break}if(6===i[0]&&c.label<o[1]){c.label=o[1],o=i;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(i);break}o[2]&&c.ops.pop(),c.trys.pop();continue}i=e.call(t,c)}catch(s){i=[6,s],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var r,n,o,a,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.onProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var Main=function(t){function e(){var e=t.call(this)||this;return e.cards=[],e.cardsPos=[],e.cardsInitPos=[],e.isdeal=!1,e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){egret.lifecycle.addLifecycleListener(function(t){t.onUpdate=function(){}}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()},this.runGame()["catch"](function(t){console.log(t)})},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return[4,this.loadResource()];case 1:return i.sent(),this.createGameScene(),[4,RES.getResAsync("description_json")];case 2:return t=i.sent(),[4,platform.login()];case 3:return i.sent(),[4,platform.getUserInfo()];case 4:return e=i.sent(),console.log(e),[2]}})})},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return i.trys.push([0,3,,4]),t=new LoadingUI,this.stage.addChild(t),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return i.sent(),[4,RES.loadGroup("preload",0,t)];case 2:return i.sent(),this.stage.removeChild(t),[3,4];case 3:return e=i.sent(),console.error(e),[3,4];case 4:return[2]}})})},e.prototype.createGameScene=function(){this.setCards(),this.setCardsPos(),this.setCardsInitPos();for(var t=0;15>t;t++){var e=this.cards[t];e.x=this.cardsInitPos[t].x,e.y=this.cardsInitPos[t].y,this.addChild(e)}var i=this.createBitmapByName("button#deal");this.addChild(i),i.touchEnabled=!0,i.x=this.stage.stageWidth/2+130,i.y=this.stage.stageHeight-80,i.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.dealHandler,this);var s=this.createBitmapByName("button#accept");this.addChild(s),s.touchEnabled=!0,s.x=this.stage.stageWidth/2+310,s.y=this.stage.stageHeight-80,s.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.acceptHandler,this),this.selectUI=new SelectListUI,this.addChild(this.selectUI),this.selectUI.x=330,this.selectUI.y=600,this.tips=new egret.TextField,this.tips.x=50,this.tips.y=680,this.tips.textColor=16776960,this.tips.size=40,this.addChild(this.tips)},e.prototype.dealHandler=function(t){this.moveCard(this.cards[14]),this.selectUI.init(),this.isdeal=!0},e.prototype.moveCard=function(t){var e=this.cards.indexOf(t),i=this.cardsPos[e];egret.Tween.get(t).to({x:i.x,y:i.y},100).call(function(t,e){this.setChildIndex(e,15-t),1>t||this.moveCard(this.cards[t-1])},this,[e,t])},e.prototype.acceptHandler=function(t){if(!this.isdeal)return void this.showTips("请先发牌！");var e;switch(this.selectUI.selectId){case 0:return void this.showTips("提示：请选择你的牌所在的列！");case 1:e=[13,10,7,4,1,14,11,8,5,2,12,9,6,3,0];break;case 2:e=[14,11,8,5,2,13,10,7,4,1,12,9,6,3,0];break;case 3:e=[14,11,8,5,2,12,9,6,3,0,13,10,7,4,1]}for(var i=[],s=0;15>s;s++){var r=this.cards[e[s]];this.setChildIndex(r,s),i.push(r)}this.cards=i;for(var n=function(t){var e=o.cardsInitPos[t];egret.setTimeout(function(){this.setChildIndex(this.cards[t],t+15),egret.Tween.get(this.cards[t]).to({x:e.x,y:e.y},250).call(function(){this.setChildIndex(this.cards[t],t)},this)},o,300*Math.floor(t/5))},o=this,s=0;15>s;s++)n(s);this.selectUI.init(),this.isdeal=!1},e.prototype.setCardsPos=function(){for(var t=0;5>t;t++)for(var e=0;3>e;e++)this.cardsPos.push(new egret.Point(750-250*e,330-70*t))},e.prototype.setCardsInitPos=function(){for(var t=0;15>t;t++)this.cardsInitPos.push(new egret.Point(55,30+5*t))},e.prototype.setCards=function(){for(var t=[],e=["a","b","c","d"];this.cards.length<15;){var i=e[Math.floor(4*Math.random())],s=Math.ceil(13*Math.random()),r=i+s;if(-1==t.indexOf(r)){t.push(r);var n=this.createBitmapByName("cards#"+r);this.cards.push(n)}}},e.prototype.showTips=function(t){this.tips.text=t,egret.setTimeout(function(){this.tips.text=""},this,2e3)},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var SelectedButton=function(t){function e(){var e=t.call(this)||this;return e._select=!1,e.createView(),e}return __extends(e,t),Object.defineProperty(e.prototype,"select",{get:function(){return this._select},set:function(t){t?(this._selectedImg.visible=!0,this._unselectedImg.visible=!1,this.drawRoundRect(!0)):(this._selectedImg.visible=!1,this._unselectedImg.visible=!0,this.drawRoundRect(!1))},enumerable:!0,configurable:!0}),e.prototype.createView=function(){this._unselectedImg=this.createBitmapByName("button#unselect"),this.addChild(this._unselectedImg),this._selectedImg=this.createBitmapByName("button#select"),this.addChild(this._selectedImg),this._selectedImg.visible=!1,this._unselectedImg.visible=!0,this._selectedBg=new egret.Shape,this.drawRoundRect(!1),this.addChild(this._selectedBg)},e.prototype.drawRoundRect=function(t){this._selectedBg.graphics.clear(),t&&this._selectedBg.graphics.lineStyle(1,16776960),this._selectedBg.graphics.beginFill(16777215,.1),this._selectedBg.graphics.drawRoundRect(-85,-560,185,560,30,30),this._selectedBg.graphics.endFill()},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},e}(egret.Sprite);__reflect(SelectedButton.prototype,"SelectedButton");var SelectListUI=function(t){function e(){var e=t.call(this)||this;return e._selectId=0,e._selectBtnList=[],e.createView(),e}return __extends(e,t),Object.defineProperty(e.prototype,"selectId",{get:function(){return this._selectId},enumerable:!0,configurable:!0}),e.prototype.init=function(){for(var t=0;3>t;t++)this._selectBtnList[t].select=!1;this._selectId=0},e.prototype.createView=function(){for(var t=0;3>t;t++){var e=new SelectedButton;this.addChild(e),e.x=250*t,e.touchEnabled=!0,this._selectBtnList.push(e),e.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.clickHandler,this)}},e.prototype.clickHandler=function(t){var e=t.currentTarget;this._selectId=this._selectBtnList.indexOf(e)+1,e.select=!0;for(var i=0;3>i;i++)i!=this._selectId-1&&(this._selectBtnList[i].select=!1)},e}(egret.Sprite);__reflect(SelectListUI.prototype,"SelectListUI");