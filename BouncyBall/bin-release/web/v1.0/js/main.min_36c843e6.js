var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);i.prototype=e.prototype,t.prototype=new i},__awaiter=this&&this.__awaiter||function(t,e,i,r){return new(i||(i=Promise))(function(n,o){function a(t){try{l(r.next(t))}catch(e){o(e)}}function s(t){try{l(r["throw"](t))}catch(e){o(e)}}function l(t){t.done?n(t.value):new i(function(e){e(t.value)}).then(a,s)}l((r=r.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function i(t){return function(e){return r([t,e])}}function r(i){if(n)throw new TypeError("Generator is already executing.");for(;l;)try{if(n=1,o&&(a=o[2&i[0]?"return":i[0]?"throw":"next"])&&!(a=a.call(o,i[1])).done)return a;switch(o=0,a&&(i=[0,a.value]),i[0]){case 0:case 1:a=i;break;case 4:return l.label++,{value:i[1],done:!1};case 5:l.label++,o=i[1],i=[0];continue;case 7:i=l.ops.pop(),l.trys.pop();continue;default:if(a=l.trys,!(a=a.length>0&&a[a.length-1])&&(6===i[0]||2===i[0])){l=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){l.label=i[1];break}if(6===i[0]&&l.label<a[1]){l.label=a[1],a=i;break}if(a&&l.label<a[2]){l.label=a[2],l.ops.push(i);break}a[2]&&l.ops.pop(),l.trys.pop();continue}i=e.call(t,l)}catch(r){i=[6,r],o=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var n,o,a,s,l={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},Ball=function(t){function e(){var e=t.call(this)||this;return e._world=World.getInstance(),e.addBall(),e}return __extends(e,t),Object.defineProperty(e.prototype,"ballBody",{get:function(){return this._ballBody},enumerable:!0,configurable:!0}),e.prototype.render=function(){this._ball.x=this._ballBody.interpolatedPosition[0],this._ball.y=this._ballBody.interpolatedPosition[1]},e.prototype.addBall=function(){this._ballBody=new p2.Body({mass:1,position:[200,400]});var t=new p2.Circle({radius:15});this._ballBody.addShape(t),this._world.addBody(this._ballBody),this._ball=new egret.Sprite,this._ball.graphics.beginFill(16776960),this._ball.graphics.drawCircle(0,0,t.radius),this._ball.graphics.endFill(),this.addChild(this._ball)},e}(egret.Sprite);__reflect(Ball.prototype,"Ball");var Bat=function(t){function e(e){var i=t.call(this)||this;return i._batWidth=100,i._world=World.getInstance(),i._stage=e,i._bat=new egret.Sprite,i._force=[0,-300],i._lastPosition=0,i.createBat(),i.addEvent(),i}return __extends(e,t),Object.defineProperty(e.prototype,"force",{get:function(){return this._force},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"body",{get:function(){return this._batBody},enumerable:!0,configurable:!0}),e.prototype.createBat=function(){this._batBody=new p2.Body({position:[this._stage.stageWidth/2,this._stage.stageHeight-50]});var t=new p2.Box({width:this._batWidth,height:80});this._batBody.addShape(t),this._world.addBody(this._batBody),this.addChild(this._bat),this.render(this._batBody)},e.prototype.render=function(t){var e=t.shapes[0];this._bat.x=t.position[0],this._bat.y=t.position[1],this._bat.graphics.clear(),this._bat.graphics.beginFill(8947848),this._bat.graphics.drawRect(-e.width/2,-e.height/2,e.width,e.height),this._bat.graphics.endFill()},e.prototype.addEvent=function(){var t=this;this._bat.touchEnabled=!0,this._bat.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(e){t._lastPosition=0,t._isTouch=!0},this),this._stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,function(e){t._isTouch&&(t._batBody.position[0]=Math.max(t._batWidth/2+10,Math.min(e.stageX,t._stage.stageWidth-10-t._batWidth/2)),t.force[0]=100*(0==t._lastPosition?0:t._batBody.position[0]-t._lastPosition),t._lastPosition=t._batBody.position[0],t.render(t._batBody))},this)},e}(egret.Sprite);__reflect(Bat.prototype,"Bat");var Brick=function(t){function e(){var e=t.call(this)||this;return e._world=World.getInstance(),e.addBrick(),e}return __extends(e,t),Object.defineProperty(e.prototype,"brickBody",{get:function(){return this._brickBody},enumerable:!0,configurable:!0}),e.prototype.render=function(){this._brick.x=this._brickBody.position[0],this._brick.y=this._brickBody.position[1]},e.prototype.addBrick=function(){this._brickBody=new p2.Body,this._brickBody.displays=[this];var t=new p2.Box({width:50,height:20});this._brickBody.addShape(t),this._world.addBody(this._brickBody),this._brick=new egret.Sprite,this._brick.graphics.beginFill(16776960),this._brick.graphics.drawRect(-t.width/2,-t.height/2,t.width,t.height),this._brick.graphics.endFill(),this.addChild(this._brick)},e.prototype.destroy=function(){this._world.removeBody(this._brickBody),this.parent.removeChild(this)},e}(egret.Sprite);__reflect(Brick.prototype,"Brick");var ButtonUI=function(t){function e(){var e=t.call(this)||this;return e._label="按钮",e.create(),e}return __extends(e,t),Object.defineProperty(e.prototype,"label",{set:function(t){this._label=t,this._labelTxt.text=t},enumerable:!0,configurable:!0}),e.prototype.create=function(){this.graphics.clear(),this.graphics.lineStyle(1,16777215),this.graphics.beginFill(0,.3),this.graphics.drawRoundRect(0,0,100,50,10),this.graphics.endFill(),this._labelTxt=new egret.TextField,this._labelTxt.textColor=16777215,this._labelTxt.textAlign=egret.HorizontalAlign.CENTER,this._labelTxt.verticalAlign=egret.VerticalAlign.MIDDLE,this._labelTxt.text=this.label,this._labelTxt.width=100,this._labelTxt.height=50,this.addChild(this._labelTxt)},e}(egret.Sprite);__reflect(ButtonUI.prototype,"ButtonUI");var InfoUI=function(t){function e(){var e=t.call(this)||this;return e._score=0,e.create(),e}return __extends(e,t),Object.defineProperty(e.prototype,"score",{get:function(){return this._score},set:function(t){this._score=t,this._inputTxt.text=String(this._score)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"label",{set:function(t){this._label.text=t},enumerable:!0,configurable:!0}),e.prototype.create=function(){this._label=new egret.TextField,this._label.textColor=16776960,this._label.text="score:",this._label.width=100,this._label.height=30,this.addChild(this._label),this._inputTxt=new egret.TextField,this._inputTxt.textColor=16776960,this._inputTxt.x=110,this._inputTxt.text=String(this._score),this.addChild(this._inputTxt)},e}(egret.Sprite);__reflect(InfoUI.prototype,"InfoUI");var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.onProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var Main=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){egret.lifecycle.addLifecycleListener(function(t){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()},this.runGame()["catch"](function(t){console.log(t)})},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.loadResource()];case 1:return t.sent(),this.createGameScene(),[2]}})})},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return i.trys.push([0,3,,4]),t=new LoadingUI,this.stage.addChild(t),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return i.sent(),[4,RES.loadGroup("preload",0,t)];case 2:return i.sent(),this.stage.removeChild(t),[3,4];case 3:return e=i.sent(),console.error(e),[3,4];case 4:return[2]}})})},e.prototype.createGameScene=function(){this._world=World.getInstance();new StartPanelUI(this.stage.stageWidth,this.stage.stageHeight);this.initMainScene()},e.prototype.initMainScene=function(){var t=this;this.addBackground(),this.initInfoPanel(),this.addBoundary(),this.addBricks(),this._bat=new Bat(this.stage),this.stage.addChild(this._bat),this._ball=new Ball,this.stage.addChild(this._ball),egret.startTick(this.moveBall,this);this._world.on("beginContact",function(e){(e.bodyA==t._ball.ballBody&&e.bodyB==t._bat.body||e.bodyB==t._ball.ballBody&&e.bodyA==t._bat.body)&&(console.log(t._bat.force),t._ball.ballBody.applyImpulse(t._bat.force,[0,0])),e.bodyA.displays&&e.bodyA.displays[0]instanceof Brick?e.bodyA.displays[0].destroy():e.bodyB.displays&&e.bodyB.displays[0]instanceof Brick&&e.bodyB.displays[0].destroy()})},e.prototype.moveBall=function(t){return this._world.step(1/60,.1,10),this._ball.render(),!1},e.prototype.addBackground=function(){var t=new egret.Sprite;t.x=0,t.y=0,t.graphics.beginFill(3355443),t.graphics.drawRect(0,0,this.stage.stageWidth,this.stage.stageHeight),t.graphics.endFill(),this.addChild(t)},e.prototype.initInfoPanel=function(){var t=new InfoUI;t.label="score",t.x=20,t.y=10,this.stage.addChild(t);var e=new InfoUI;e.label="time",e.x=400,e.y=10,this.stage.addChild(e)},e.prototype.addBoundary=function(){this.addStaticPanel(10,50,0,1,this.stage.stageWidth-20),this.addStaticPanel(this.stage.stageWidth-10,50,Math.PI/2,3,this.stage.stageHeight-60),this.addStaticPanel(this.stage.stageWidth-10,this.stage.stageHeight-10,Math.PI,3,this.stage.stageWidth-20),this.addStaticPanel(10,this.stage.stageHeight-10,270*Math.PI/180,4,this.stage.stageHeight-60)},e.prototype.addStaticPanel=function(t,e,i,r,n){var o=new p2.Body({position:[t,e],angle:i,id:r}),a=new p2.Plane({});o.addShape(a),this._world.addBody(o);var s=new egret.Sprite;s.x=o.position[0],s.y=o.position[1],s.graphics.lineStyle(3,0),s.graphics.moveTo(0,0),s.graphics.lineTo(n,0),s.graphics.endFill(),s.rotation=180*o.angle/Math.PI,this.addChild(s)},e.prototype.addBricks=function(){for(var t=0;8>=t;t++)for(var e=0;5>=e;e++){var i=new Brick;i.brickBody.position[0]=80+60*t,i.brickBody.position[1]=200+40*e,i.render(),this.addChild(i)}},e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var StartPanelUI=function(t){function e(e,i){var r=t.call(this)||this;return console.log(e,i),r._width=e,r._height=i,r.drawBack(),r.addTitle(),r.addButton(),r}return __extends(e,t),Object.defineProperty(e.prototype,"startBtn",{get:function(){return this._startBtn},enumerable:!0,configurable:!0}),e.prototype.drawBack=function(){this.graphics.clear(),this.graphics.beginFill(2236962),this.graphics.drawRect(0,0,this._width,this._height),this.graphics.endFill()},e.prototype.addTitle=function(){var t=new egret.TextField;t.text="弹力球",t.size=80,t.x=this._width/2-t.width/2,t.y=this._height/4,this.addChild(t)},e.prototype.addButton=function(){this._startBtn=new ButtonUI,this._startBtn.label="开始",this._startBtn.x=this._width/2-this._startBtn.width/2,this._startBtn.y=this._height/1.5,this.addChild(this._startBtn)},e}(egret.Sprite);__reflect(StartPanelUI.prototype,"StartPanelUI");var World=function(){function t(){}return t.getInstance=function(){return t._instance||(t._instance=new p2.World({gravity:[0,10.8]}),t._instance.defaultContactMaterial.restitution=1),t._instance},t}();__reflect(World.prototype,"World");