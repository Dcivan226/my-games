var __reflect=this&&this.__reflect||function(t,e,n){t.__class__=e,n?n.push(e):n=[e],t.__types__=t.__types__?n.concat(t.__types__):n},__extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);n.prototype=e.prototype,t.prototype=new n},__awaiter=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(o,i){function a(t){try{u(r.next(t))}catch(e){i(e)}}function c(t){try{u(r["throw"](t))}catch(e){i(e)}}function u(t){t.done?o(t.value):new n(function(e){e(t.value)}).then(a,c)}u((r=r.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function n(t){return function(e){return r([t,e])}}function r(n){if(o)throw new TypeError("Generator is already executing.");for(;u;)try{if(o=1,i&&(a=i[2&n[0]?"return":n[0]?"throw":"next"])&&!(a=a.call(i,n[1])).done)return a;switch(i=0,a&&(n=[0,a.value]),n[0]){case 0:case 1:a=n;break;case 4:return u.label++,{value:n[1],done:!1};case 5:u.label++,i=n[1],n=[0];continue;case 7:n=u.ops.pop(),u.trys.pop();continue;default:if(a=u.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){u=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){u.label=n[1];break}if(6===n[0]&&u.label<a[1]){u.label=a[1],a=n;break}if(a&&u.label<a[2]){u.label=a[2],u.ops.push(n);break}a[2]&&u.ops.pop(),u.trys.pop();continue}n=e.call(t,u)}catch(r){n=[6,r],i=0}finally{o=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var o,i,a,c,u={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return c={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c},Line=function(){function t(){this._reflect=!0,this._startPoint=new egret.Point(0,0),this._endPoint=new egret.Point(10,100),this._reflect=!0}return Object.defineProperty(t.prototype,"startPoint",{get:function(){return this._startPoint},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"endPoint",{get:function(){return this._startPoint},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"reflect",{get:function(){return this._reflect},set:function(t){this._reflect=t},enumerable:!0,configurable:!0}),t.prototype.getRotation=function(){var t=this.startPoint,e=this.endPoint;return Math.atan2(e.y-t.y,e.x-t.x)},t}();__reflect(Line.prototype,"Line");var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.onProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var Main=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){egret.lifecycle.addLifecycleListener(function(t){t.onUpdate=function(){}}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()},this.runGame()["catch"](function(t){console.log(t)})},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(n){switch(n.label){case 0:return[4,this.loadResource()];case 1:return n.sent(),this.createGameScene(),[4,RES.getResAsync("description_json")];case 2:return t=n.sent(),[4,platform.login()];case 3:return n.sent(),[4,platform.getUserInfo()];case 4:return e=n.sent(),console.log(e),[2]}})})},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,3,,4]),t=new LoadingUI,this.stage.addChild(t),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return n.sent(),[4,RES.loadGroup("preload",0,t)];case 2:return n.sent(),this.stage.removeChild(t),[3,4];case 3:return e=n.sent(),console.error(e),[3,4];case 4:return[2]}})})},e.prototype.createGameScene=function(){var t=this.createBitmapByName("pen_png");this.addChild(t),ObjectDecorator.get(t).addDragAction(this.stage).touchMoveHandler(function(){console.log(1245)}).touchEndHandler(function(){console.log("end")})},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,n=RES.getRes(t);return e.texture=n,e},e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var ObjectDecorator=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.get=function(t){return e.obj=t,e},e.addDragAction=function(t){return e.stage=t,e.obj.addEventListener(egret.TouchEvent.TOUCH_BEGIN,e.touchBeginHandler,this),t.addEventListener(egret.TouchEvent.TOUCH_MOVE,e.stageTouchMoveHandler,this),e},e.touchEndHandler=function(t){return e.touchEndCall=t,e},e.touchMoveHandler=function(t){return e.touchMoveCall=t,e},e.touchBeginHandler=function(t){e.touchDown=!0,e.obj=t.currentTarget,e.stage.addEventListener(egret.TouchEvent.TOUCH_END,e.stageTouchEndHandler,this),console.log(t.currentTarget)},e.stageTouchMoveHandler=function(t){e.obj.x=t.stageX,e.obj.y=t.stageY,e.touchMoveCall instanceof Function&&e.touchMoveCall()},e.stageTouchEndHandler=function(t){console.log("endd"),e.stage.removeEventListener(egret.TouchEvent.TOUCH_END,e.stageTouchEndHandler,this),e.touchEndCall instanceof Function&&e.touchEndCall()},e.touchDown=!1,e.touchEnd=!1,e.touchMove=!1,e}(egret.DisplayObject);__reflect(ObjectDecorator.prototype,"ObjectDecorator");var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var RayLine=function(){function t(){this._startPoint=new egret.Point(0,0),this._direction=0}return Object.defineProperty(t.prototype,"startPoint",{get:function(){return this._startPoint},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"direction",{get:function(){return this._direction},enumerable:!0,configurable:!0}),t.prototype.getPoint=function(t){var e=t*Math.cos(this._direction),n=t*Math.sin(this._direction);return new egret.Point(this._startPoint.x+e,this._startPoint.y+n)},t.prototype.hitLine=function(t,e){var n,r=this._startPoint,o=this.getPoint(t),i=e.startPoint,a=e.endPoint;if(n=this.segmentsIntr(r,o,i,a)){var c=this.getDistance(r,n);if(3>c)return null}return n},t.prototype.getReflexLine=function(e,n){var r;if(r=this.hitLine(e,n)){var o=n.getRotation(),i=new t;return i._startPoint=r,i._direction=2*o-this._direction,i}return null},t.prototype.segmentsIntr=function(t,e,n,r){var o=(e.y-t.y)*(r.x-n.x)-(t.x-e.x)*(n.y-r.y);if(0==o)return null;var i=((e.x-t.x)*(r.x-n.x)*(n.y-t.y)+(e.y-t.y)*(r.x-n.x)*t.x-(r.y-n.y)*(e.x-t.x)*n.x)/o,a=-((e.y-t.y)*(r.y-n.y)*(n.x-t.x)+(e.x-t.x)*(r.y-n.y)*t.y-(r.x-n.x)*(e.y-t.y)*n.y)/o;return console.log((a-t.y)*(a-e.y)),Math.round(i-t.x)*Math.round(i-e.x)<=0&&Math.round(a-t.y)*Math.round(a-e.y)<=0&&Math.round(i-n.x)*Math.round(i-r.x)<=0&&Math.round(a-n.y)*Math.round(a-r.y)<=0?new egret.Point(i,a):null},t.prototype.getDistance=function(t,e){return Math.sqrt((t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y))},t}();__reflect(RayLine.prototype,"RayLine");